<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../plakat-spinner/plakat-spinner.html">
<link rel="import" href="plakat-poster.html">
<script src="board.js"></script>

<polymer-element name="plakat-board">
	<template>
		<template id="aaa" repeat="{{page, i in pages}}">
			<core-ajax auto url="http://www.plakat.com.br/posters.json" params='{"per_page": "5", "page": "{{i + 1}}", "term": ""}' handleAs="json" response="{{responses[i]}}" on-core-response="{{pagesResponse}}"></core-ajax>
		</template>
		<style>
			:host {
				position: relative;
				display: block;
				margin: 32px 16px;
				padding-bottom: 32px;
			}

			plakat-spinner {
				visibility: hidden;
				position: absolute;
				display: -webkit-flex;
				display: flex;
				left: 0;
				right: 0;
				bottom: 0;
				justify-content: center;
			}

			plakat-spinner.active {
				visibility: visible;
			}
		</style>

		<template repeat="{{response in responses}}">
			<template repeat="{{response}}">
				<plakat-poster heading="{{title}}" desc="{{description}}" img="{{ref_imagem.small.url}}"></plakat-poster>
			</template>
		</template>

		<plakat-spinner id="spinner"></plakat-spinner>

	</template>
	<script>
		Polymer('plakat-board', {
			loading: false,
			responses: [],
			pages: [''],

			loadPage: function() {
				console.log(this.loading);
				if (this.loading) return;

				this.$.spinner.classList.add('active');
				this.loading = true;
				this.pages.push('');
			},

			pagesResponse: function() {
				this.$.spinner.classList.remove('active');
				this.loading = false;
			},

			responsesChanged: function() {
				var self = this;

				setTimeout(function() {
					new Board(self, self.shadowRoot.querySelectorAll('plakat-poster'), 16);
				}, 1);
			}
		});
	</script>
</polymer-element>